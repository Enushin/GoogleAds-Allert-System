# プロダクト要件定義書（PRD）

## 1. 背景と目的
Google広告の運用担当者が日次の費用進捗を迅速に把握し、予算超過や消化不足を早期に検知できるようにすることを目的とした通知システムを構築する。Google Ads APIから取得した当日の費用データをもとに、現在の消化率と24時時点の予測着地額を日本時間で複数回通知する。

## 2. ゴール
- 日本時間ベースで日次予算の進捗状況と24時時点の着地予測を自動的に算出・通知できる。
- ユーザーが任意の計算・通知スケジュール（1日複数回）を設定できる。
- 通知メッセージに、当日の予測結果と当月の消化ペース指標が含まれる。

## 3. スコープ
### 含む
- Google Ads APIを用いた日次費用データの取得。
- 現在時刻と経過時間を基にした当日24時の着地予測（単純比例計算）。
- 1日複数回の計算スケジュール設定および通知トリガー。
- 指定されたSlackなどのチャンネルへの通知送信（Webhook/API）。
- 当月の想定消化ペース（現時点の平均日額×残日数）の計算。

### 含まない（アウトオブスコープ）
- 月末着地予測の詳細分析（MVPでは後回し）。
- 入札調整やキャンペーン停止などの自動アクション。
- 複数アカウントを横断したダッシュボードUIの提供。

## 4. ターゲットユーザー
- 広告代理店や事業会社の広告運用担当者。
- 予算進捗に対する高頻度の可視化・通知を必要とする少数チーム。

## 5. ユースケース
1. 毎朝9時と15時に日次予算の消化状況と24時着地予測をSlackで受け取り、運用判断を行う。
2. 日中に急激な消化が発生した場合、次回通知で異常を検知し、予算調整を実施する。
3. 当月の消化ペースを把握し、経営層への報告資料の一次情報として利用する。

## 6. 機能要件
- Google Ads APIから指定アカウントの当日費用を取得できること。
- 日本時間の現在時刻と費用実績を基に、当日残時間から単純比例で着地予測額を計算すること。
- ユーザー設定に従い、1日複数回のスケジュールで予測処理を実行できること。
- 通知文面に以下の情報を含めること：
  - 計測時点の費用総額と進捗率
  - 当日24時の着地予測額
  - 月間予算に対する現時点のペース（例：月間予算の何％ペースか）
- 通知失敗時にログへエラーを記録し、必要に応じて再試行を行う。
- 設定値（API認証情報、予算、スケジュール、通知先URLなど）を安全に管理できる。

## 7. 非機能要件
- API呼び出しや通知処理の失敗をログに記録し、再試行ポリシー（指数バックオフ）を適用する。
- タイムゾーンを日本時間で厳密に処理するため、テストで境界時刻（0時・24時付近）を検証する。
- 設定ファイルや環境変数経由で機密情報を管理し、リポジトリに平文で残さない。
- Dockerなどのコンテナ化を想定し、ローカル・本番で同一挙動を目指す。

## 8. 受け入れ基準
- [ ] 日本時間で設定したスケジュールに従い、Google Ads APIから当日費用データを取得できる。
- [ ] 取得したデータを元に、当日24時の着地予測額を正しく算出できる。
- [ ] 通知メッセージに、現在の費用、日次着地予測、月間ペース情報が含まれる。
- [ ] 指定したSlackチャンネルへWebhookで通知を送信できる。
- [ ] エラー発生時にログへ記録され、必要に応じて再試行される。

## 9. ユーザーストーリー（優先度順）
1. 広告運用者として、毎日複数回の費用・予測通知を受け取り、日次予算管理を自動化したい。
2. 広告運用者として、当月の消化ペースが予算通りかを把握したい。
3. 広告運用者として、通知障害やAPIエラーを把握し、迅速に対処したい。

## 10. リスクと前提条件
- リスク：Google Ads APIのレート制限や認証エラー、Slack側の障害、タイムゾーン計算ミス。
- 緩和策：APIリトライ実装、詳細ログと監視、境界時刻テスト、通知失敗時の警告ログ。
- 前提条件：Google Ads APIの認証情報、通知先Webhook URL、月間予算・日次目標値が提供されること。

## 11. PlanFix（ApprovedSteps 案）
1. Google Ads APIクライアントの設定とサンプルデータ取得の確認。
2. 日次予測ロジック（単純比例計算）の実装とテスト。
3. スケジューラと通知ワークフローの構築。
4. 設定管理・ログ基盤の整備と最終統合テスト。

## 12. AutonomyBudget（案）
- 時間: 30分
- 想定変更行数: 200行
- 変更ファイル数: 5
- 新規依存ライブラリ: 0

