---
title: "次のアクションプラン"
status: "Draft"
version: "0.1.0"
language: "ja"
---

# フェーズ別の次ステップ

## MVPローンチ集中アクション（報告系は後回し）

### いま即座に片付けるローンチ阻害要因（Blockerのみに限定）
- [ ] `.env` に本番想定の資格情報と予算値を投入し、`python -m google_ads_alert run --dry-run` で本番データなしの動作確認を行う。
- [ ] `python -m google_ads_alert run` をテストアカウントで1日分運用し、Slack通知内容とスケジュール遅延が許容範囲かを確認する。
- [ ] `python -m google_ads_alert serve` を想定デプロイ環境で実行し、BlockingScheduler が日本時間トリガーで安定稼働するかを監視ログで確認する。
- [ ] 運用初期の連絡フロー（失敗時の一次連絡先・再試行手順）をドキュメント化し、Slackチャンネルの Topic などに貼り付ける。

### ローンチGo判定チェックシート（報告タスクは対象外）

| タスク | 担当 | 完了基準 | メモ |
| --- | --- | --- | --- |
| `.env` に認証情報と予算上限を設定し、`run --dry-run` の成功ログをSlackに共有する | プロジェクトリード | Slack に Dry-run のスクリーンショットが残っている | レポーティング系ログの整形は不要 |
| `run` の本番同等実行を単発で走らせ、通知文面にズレがないことをレビュー | 開発担当 | チーム合意済みの通知サンプルへ✅リアクション | 表形式レポート化は後回し |
| `serve` 常駐とBlockingScheduler遅延の監視結果を記録する | SRE担当 | 遅延<±60秒の証跡がSlackログにある | ダッシュボード整備は不要 |
| 失敗時連絡フローをSlack Topicに記載し、運用当番へ引き継ぐ | 運用担当 | Topic 更新履歴と当番確認のリアクション | レポーティング係は未割当で問題なし |

### 最短ローンチのための3ステップ
1. `python -m google_ads_alert run --dry-run` でAPI疎通と通知フォーマットを即時確認し、主要設定値（認証情報・予算・Slack URL）が揃っているかを検証する。
2. Dry-runで得たペイロードをチーム合意済みテンプレートとして固定し、`python -m google_ads_alert run` の本番同等実行を1回だけ走らせて当日の通知を実際に届ける。
3. `python -m google_ads_alert serve` を常駐させ、BlockingScheduler が希望時刻で動くことをSlack通知ログで確認し次第、ローンチ判定ミーティングに進む。

> **ローンチ優先宣言**: 上記ブロッカー解消と3ステップの完了が唯一のGo判定条件。ダッシュボードやレポーティング作業は **MVP後のバックログに強制的に送る**。

### 72時間ローンチタイムライン（目安）
- **T0〜T+12h（オーナー: プロジェクトリード）**
  - `.env` 認証情報を投入し、`run --dry-run` を平常時と費用ゼロ時の2パターンで検証する。
  - 成果物: Dry-runログ（Slackペイロード含む）、検証メモ。
- **T+12h〜T+24h（オーナー: 開発担当）**
  - テストアカウントで `run` を定期実行し、通知テンプレートの文面と差分ハイライトをレビューする。
  - 成果物: 実行ログ、通知スクリーンショット。
- **T+24h〜T+48h（オーナー: SRE担当）**
  - `serve` コマンドでBlockingSchedulerを起動し、遅延・例外ログを収集する。
  - 成果物: スケジュール実行レポート、監視チャンネル投稿。
- **T+48h〜T+72h（オーナー: プロジェクトリード + 開発担当）**
  - 連絡フロードキュメントを仕上げ、ローンチGo/No-Goレビューを開催する。
  - 成果物: Slack Topic原稿、レビュー議事メモ。

> **Tips**: 各ステップのログ/スクリーンショットは Slack の `#mvp-launch` スレッドに集約し、Go/No-Go判定の材料にする。

## 直近で着手すべきタスク（優先度高）
- [x] Google Ads APIの認証情報取得プロセスを整理し、必要な資格情報を揃える。（詳細: [Google Ads API認証・通知Webhook設定ガイド](credentials_and_webhook_guide.md)）
- [x] Slackなど通知チャンネル向けWebhookの設定方法と秘匿化方針を決定する。（詳細: [Google Ads API認証・通知Webhook設定ガイド](credentials_and_webhook_guide.md)）
- [x] 日本時間ベースでのスケジュール要件を定義し、初回の計測・通知タイムテーブル案を作成する。
- [x] Google Ads APIクライアントの最小実装を設計し、タイムゾーンを考慮したテスト方針を固める。
- [x] 日次着地予測および月間ペース計算のロジックを実装し、単体テストを整備する。
- [x] 実運用を見据えた設定値読込レイヤー（.env/Secrets Manager等）の設計とダミー実装を追加する。

## 1. 仕様・設定整理
- [x] Google Ads APIの利用要件を整理し、必要な認証情報（OAuth2クライアントID、リフレッシュトークン、開発者トークンなど）の取得手順をまとめる。
- [x] 通知チャンネル（例: Slack）のWebhook URLや認証方式を確認し、セキュアな保管方法（環境変数、シークレットマネージャ等）を決定する。
- [x] 日本時間でのスケジューリング要件を明文化し、日内の計測・通知タイミングのサンプルスケジュールを定義する。
    - サンプル: 08:00 / 14:00 / 20:00（1日3回、主要時間帯に集中）

## 2. アーキテクチャ設計
- [x] Google Ads APIクライアント、スケジューラ、予測ロジック、通知モジュールの責務分離を図るクラス／モジュール設計を行う。
- [x] 設定ファイル形式（YAML/JSON/.envなど）と読み込みフローを決定し、ローカル・本番双方で共通利用できる構成案を作成する。
- [x] エラーハンドリングとリトライ戦略（指数バックオフ、最大試行回数など）を各コンポーネントで統一的に扱うための設計方針を策定する。
    - `GoogleAdsCostService` に `RetryConfig` を導入し、再試行回数・待機秒数・対象例外を設定可能にした。
- [x] ロギング／監視の責務を担う共通ユーティリティ層のインターフェース案をまとめる。
    - `google_ads_alert.logging_utils` でタイムゾーン考慮済みのロガー初期化関数と子ロガー取得関数を提供した。

## 3. 実装準備
- [x] Google Ads APIライブラリおよび通知チャンネル向けSDK/HTTPクライアントの導入要否を評価し、必要な依存関係リストを確定する。
- [x] 環境変数ベースの設定テンプレートとサンプル `.env` を用意し、Secrets共有手順を追記する。
- [x] テスト戦略（単体・結合・E2E）に基づき、モック・スタブの利用方針とテストデータ準備手順を整備する。（詳細: [テスト戦略と検証手順](testing_strategy.md)）
- [x] ローカル開発環境でのcron/scheduler相当の実行方法を決定し、擬似スケジューリングの検証方法を明文化する。（詳細: [テスト戦略と検証手順](testing_strategy.md#2-ローカルスケジューラ検証手順)）
- [x] Google Ads APIのサンドボックス／mock transportを利用した統合テスト実行手順を文書化する。（詳細: [テスト戦略と検証手順](testing_strategy.md#3-google-ads-api-サンドボックスmock-transport)）

## 4. MVP実装ロードマップ
- [x] Google Ads APIから日次費用データを取得する最小限のAPIクライアントを作成し、日付・タイムゾーン処理の単体テストを用意する。
- [x] 取得データを基に当日24時の着地予測を算出するBudget Predictorのプロトタイプを作成し、単純比例ロジックのテストを整備する。
- [x] 通知テンプレート（本文構成、メトリクス表示フォーマット）を定義し、Slack等へメッセージ送信するNotification Handlerを実装する。
- [x] スケジューラ（APSchedulerやCloud Scheduler等）を活用し、ユーザー指定時刻でのジョブ実行を実現する。
    - `google_ads_alert serve` コマンドを追加し、`.env` から読み込んだスケジュール設定に基づき Cron トリガーで日次ジョブを登録する `BlockingScheduler` 初期化ロジックを実装した。
    - APScheduler が利用できない環境でもカスタムスケジューラを差し替えられるよう、`SchedulerFactory` プロトコルを用意してテスト可能性を確保した。
- [x] Combined forecast結果を通知フォーマットへ統合し、UI／メッセージ例を作成する。
    - `workflow.py` にスナップショット作成とSlackペイロード送信ユーティリティを追加し、`build_slack_notification_payload` を利用した通知処理を一元化した。
- [x] プロジェクト全体の設定検証コマンド（`python -m google_ads_alert doctor`）を実装し、運用前セルフチェック手順を整備する。
    - `google_ads_alert.cli.run_doctor` で環境変数または `.env` ファイルから設定を読み込み、Webhook・予算設定・スケジュール生成を検証できるようになった。
    - `python -m google_ads_alert schedule` で設定済みスケジュールの今後の実行時刻を日本語タイムゾーンに合わせて確認できるプレビュー機能を追加した。
- [x] 単発実行用のCLI（`python -m google_ads_alert run`）を実装し、API問い合わせからSlack送信までの一連のフローを検証できるようにする。
    - `run_once` で `GOOGLE_ADS_TRANSPORT` 経由のカスタムトランスポートを組み込み、`--dry-run` ではSlack送信をスキップしてペイロードを表示できる。
    - Slack送信ファクトリも `SLACK_SENDER_FACTORY` で差し替え可能とし、Webhookが利用できない環境でもJSON出力で確認できる。

## 5. 運用と監視
- [x] ログ出力ポリシー（ログレベル、フォーマット、出力先）を定義し、主要イベントとエラートレースを確実に記録できるよう整備する。
    - `docs/logging_policy.md` にポリシーをまとめ、CLI 各コマンドで INFO/ERROR ログと例外スタックトレースを出力するよう実装した。
- [x] 主要メトリクス（API呼び出し成功率、通知成功率、予測誤差など）の監視方法を検討し、必要なダッシュボードまたはアラート設定の要件をまとめる。
    - 詳細: [監視指標とアラート要件](monitoring_metrics.md) にメトリクス一覧、ダッシュボード構成、アラート設計を整理した。
- [x] 障害発生時の手順（再試行、手動通知、エスカレーションフロー）を策定し、運用ドキュメントとして共有する。
    - 詳細: [障害対応ランブック](incident_response_runbook.md) に標準対応フローと Postmortem テンプレートを整理した。
- [x] SLA/SLIの初期指標を簡易に定義し、MVPで追跡する項目を決める。（詳細: [SLA/SLI定義ガイド](sla_sli_guidelines.md)）
- [x] インシデントレビューのテンプレートを用意し、必要最小限の振り返り手順を整理する。（詳細: [インシデントレビュー記録テンプレート](incident_review_template.md)）

### 今後の検討（MVP後）
- [x] SLI計測の自動化やダッシュボード連携（BigQuery / Looker Studio等）を整備する。
    - `python -m google_ads_alert metrics <history.jsonl>` コマンドで、Slack通知や予測処理成功率などのSLIを即時集計できるようになった。
    - `--start` / `--end` で解析対象期間を限定し、`--format json` でレビュー資料に貼り付けやすいJSONを取得するシンプルな運用を想定する。
    - `--group-by day --timezone Asia/Tokyo` を利用すると、日本時間基準で日次のSLIレポートを自動生成でき、手動での仕分け作業が不要になる。
    - 週単位の傾向把握が必要な場合は `--group-by week` を指定し、ISO週ごとの成績をそのままレビュー資料に転記できる。
    - 月次レビューには `--group-by month` を指定し、タイムゾーンを揃えたうえで月単位の達成率を一覧化すれば、定例報告用の資料作成を省力化できる。
- [ ] 定期的なSLOレビュー会議と報告テンプレートを設計する。

## 6. 拡張検討
- [ ] 月間予測機能を追加する際のデータ要件と予測アルゴリズムの選択肢を洗い出し、技術調査タスクを整理する。
- [ ] 複数アカウント対応や通知チャネル追加を想定した設定項目の拡張性を評価し、設定スキーマ改善案を検討する。
- [ ] コスト効率化やリソース最適化のためのインフラ構成（サーバーレス、コンテナ化、CI/CD）を段階的に整える計画を策定する。

#### レポーティング関連の後追いタスク
- ダッシュボード構築や自動SLOレビュー会議は MVP リリース後、安定稼働を確認してから再開する。
- `docs/monitoring_metrics.md` に記載したダッシュボード要件・アラート設計は backlog とし、初期はログ監視＋手動レビューで代替する。
- SLA/SLI の正式レポートテンプレート化は、運用で得た実績値をもとに再評価する。

## 付録: スケジュール要件詳細

- 日次アラートは既定で日本時間（Asia/Tokyo）に合わせて 08:00 / 14:00 / 20:00 の3回実行する。
- 実行回数を増減する場合でも、開始・終了アンカー時刻を明示して等間隔に分割する。
- 祝日や営業時間外の運用ポリシーが定まっていないため、初期リリースでは常にスケジュールを生成し、不要な時間帯は設定で除外する。
- 設定値は `DailyScheduleConfig` で一元管理し、テストではアジア・東京以外のタイムゾーンも明示的に検証する。

## 付録: Google Ads APIクライアント設計メモ

- `google_ads_client.py` で `GoogleAdsCostService` を定義し、日次の費用集計とGAQLクエリ構築を担う。
- `GoogleAdsSearchTransport` プロトコルを導入し、テスト時にはダミー実装を差し替えることで外部依存を排除する。
- レポート期間は `build_daily_query_range` でローカル日付境界を算出し、`DailyCostSummary` として費用をマイクロ単位で保持する。
- 単体テストでは日本時間へのローカライズと費用合算を検証し、将来的なAPIエラー処理追加の足場とする。

## 付録: 設定読込ユーティリティの現状

- ルート直下に `.env.example` を追加し、Google Ads認証情報・Slack通知設定・スケジュール関連の主要キーをサンプルとして提示した。
- `google_ads_alert.config.load_env_file` で `.env` ファイルを解析し、コメント行や `export` 形式にも対応したマッピングを返す。
- `google_ads_alert.config.load_config_from_env_file` を利用することで、`.env` の値をベース環境変数とマージしながら `ApplicationConfig` を構築できる。
- Secrets Manager 等を採用する際も、マージ用の `base_env` に各種資格情報を注入する方針とする。

