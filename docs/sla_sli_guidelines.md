---
title: "SLA/SLI定義ガイド"
status: "Draft"
version: "0.1.0"
language: "ja"
---

# SLA/SLI定義ガイド

Google Ads予算アラートシステムのMVPにおけるサービス品質の基準をざっくり整理する。現時点では自動ETLやLooker Studioダッシュボードを前提にせず、手動確認で運用可能な最小限の指標を合意することを目的とする。

## 1. サービススコープ

- 対象: Google Ads単一アカウントの費用取得、当日24時時点の着地予測、Slackへの通知配信。
- 運用時間: 日本時間 07:00〜23:00 を想定。深夜帯のジョブは必須ではなく、必要に応じて一時停止する。
- アラート頻度: デフォルトは 1日2回（午前/夕方）。利用者が増えた場合のみ追加スケジュールを検討する。

## 2. 初期SLI案

| カテゴリ | SLI定義 | 計測方法 | 初期SLO目安 | 備考 |
| --- | --- | --- | --- | --- |
| 通知実行率 | 予定ジョブのうちSlack通知まで完了した割合 | 実行ログの成功/失敗を日次で目視集計 | 95% | リトライ成功分も成功としてカウント |
| 予測処理成功率 | Google Ads API取得から予測計算までエラーなく完了した割合 | CLI出力とログを手動確認 | 95% | API障害時は除外メモを残す |
| データ鮮度 | 通知時点の取得データが当日分になっている割合 | 通知内容に含める取得日時を確認 | 90% | 遅延発生時はメモ欄で共有 |

> **メモ**: 予測精度の定量評価（MAPEなど）は、実績データの蓄積後に改めて定義する。MVPでは通知内容に予測ロジックの前提を明示し、利用者が過度に依存しないよう伝える。

## 3. SLAの方向性（MVP）

- 通知が予定時刻に連続で失敗した場合は、手動での状況共有（Slack/メール）を行い、復旧予定を明示する。
- 重大なAPI障害が発生した場合は、1営業日以内に影響範囲と暫定対応を共有する。正確なSLA数値は正式リリース時に再定義する。
- 予測結果が取得できなかった場合でも、取得失敗の理由と次回実行予定を通知に含めることで透明性を確保する。

## 4. 運用・レビュー体制（暫定）

1. 通知コマンドの実行ログを日次で簡易確認し、失敗時は `incident_response_runbook.md` を参照して手動再実行する。
2. 週1回、SLI表を更新して達成状況を共有する。初期はスプレッドシートまたはテキストベースのメモで問題ない。
3. SLIを満たせなかったケースは `incident_review_template.md` を用いて簡易に振り返り、再発防止の必要性を検討する。

## 5. 今後の拡張候補

- データ蓄積と運用が安定した段階で、自動ETLやLooker Studioダッシュボード化を検討する。
- 予測精度の定量指標やエラーバジェット管理は、月次予測機能の実装時に再検討する。
- PagerDuty等のオンコール連携が必要になった場合は、通知実行率SLIと合わせて応答時間SLAを設定し直す。

## 6. 自動集計ツール

- `python -m google_ads_alert metrics <history.jsonl>` を実行すると、JSON Lines形式で記録したジョブ履歴から以下のSLIを自動算出できる。
  - 通知実行率（成功ジョブ / 実行ジョブ）
  - 予測処理成功率（`forecast_success` フラグが付与されたジョブの成功割合）
  - データ鮮度率（`data_fresh` フラグが付与されたジョブの割合）
- レポート出力には集計時刻・解析対象件数・各指標の分子/分母/達成率が含まれる。日次レビュー時はこのコマンドの出力をSlackやSLOメモに貼り付ければ手動集計の負荷を減らせる。
- `--start` / `--end` オプションを指定すると、指定したISO 8601形式の日時範囲内のレコードのみを対象に集計できる。タイムゾーン省略時はUTCとして扱われる。
- `--format json` を指定すると、集計結果をJSONで取得できるため、ダッシュボード連携や自動記録に利用しやすい。
- `--group-by day --timezone Asia/Tokyo` のように指定すれば、ジョブ履歴を日本時間など任意のタイムゾーンで日付単位に自動グルーピングし、各日のSLIをその場で表示・JSON出力できる。同様に `--group-by week` を用いればISO週（例: 2024-W18）ごとの達成状況を比較
  できる。さらに `--group-by month` を組み合わせれば、月次レビュー用の資料をそのまま生成でき、手動でスプレッドシートへ貼り分ける作業は不要。
